flowchart TB
 subgraph subGraph0["Frontend Layer"]
        UI["ğŸ¨ Next.js App"]
        Voice["ğŸ¤ Voice Interface<br>WebRTC"]
        Chat["ğŸ’¬ Chat Interface"]
        Dashboard["ğŸ“Š Dashboard"]
        Habits["âœ… Habits"]
        Rewards["ğŸ Rewards"]
        Profile["ğŸ‘¤ Profile"]
  end
 subgraph subGraph1["Context Providers"]
        UserProvider["ğŸ‘¤ UserProvider"]
        ChatProvider["ğŸ’¬ ChatProvider"]
        DatabaseProvider["ğŸ’¾ DatabaseProvider"]
        EventProvider["ğŸ“¡ EventProvider"]
  end
 subgraph subGraph2["API Layer"]
        ChatAPI["/api/chat/completions"]
        AuthAPI["/api/auth/setup"]
        SessionAPI["/api/session"]
        CSRFAPI["/api/csrf"]
  end
 subgraph subGraph3["AI Infrastructure"]
        KeywordsAI["ğŸ§  Keywords AI<br>LLM Gateway<br>250+ Models"]
        OpenAI["ğŸ¤– OpenAI<br>Fallback"]
        Mem0["ğŸ§  Mem0<br>Memory System<br>Vector Storage"]
        Tavily["ğŸ” Tavily<br>Real-time Search"]
  end
 subgraph subGraph4["AI Agents Ecosystem"]
        GeneralAgent["ğŸ¤– General Agent<br>Primary Assistant"]
        HabitCoach["ğŸƒ Habit Coach<br>Evidence-based"]
        UserDataAgent["ğŸ“Š User Data Agent"]
        PointsCalc["ğŸ¯ Points Calculator"]
        RewardsManager["ğŸ Rewards Manager"]
        Greeter["ğŸ‘‹ Greeter Agent"]
  end
 subgraph subGraph5["Functions & Tools"]
        DatabaseFunctions["ğŸ“Š Database Functions<br>getUserData()<br>completeHabit()<br>getUserStats()"]
        MemoryFunctions["ğŸ§  Memory Functions<br>searchMemories()<br>addMemory()<br>getRelevantMemories()"]
        SearchFunctions["ğŸ” Search Functions<br>searchWeb()<br>searchNews()<br>getQuickAnswer()"]
        AnalyticsFunctions["ğŸ“ˆ Analytics Functions<br>trackHabitCompletion()<br>trackMemoryOperation()"]
  end
 subgraph subGraph6["Data Storage"]
        Supabase["ğŸ—„ï¸ Supabase<br>Primary Database<br>Users, Memory History<br>RLS Enabled"]
        IndexedDB["ğŸ’¾ IndexedDB<br>Local Storage<br>Habits, Completions<br>Offline Support"]
        VectorStore["ğŸ§® Vector Store<br>1536-dim Embeddings<br>Conversation Memory"]
  end
 subgraph subGraph7["Analytics & Monitoring"]
        KeywordsAnalytics["ğŸ“Š Keywords AI Analytics<br>Usage, Costs, Performance"]
        CustomEvents["ğŸ“ˆ Custom Events<br>Habit Completion<br>Memory Operations<br>Search Operations"]
        Performance["âš¡ Performance Monitoring<br>API Response Times<br>Query Performance"]
  end
 subgraph Security["Security"]
        SupabaseAuth["ğŸ” Supabase Auth<br>JWT Tokens"]
        RLS["ğŸ›¡ï¸ Row Level Security"]
        CSRF["ğŸ”’ CSRF Protection"]
        RateLimit["â±ï¸ Rate Limiting"]
  end
 subgraph subGraph9["External Services"]
        TavilyAPI["ğŸŒ Tavily API<br>Web Search<br>News Search<br>Quick Answers"]
        KeywordsAPI["ğŸ”— Keywords AI API<br>LLM Proxy<br>Analytics Platform"]
        SupabaseCloud["â˜ï¸ Supabase Cloud<br>Hosted PostgreSQL"]
  end
    User["ğŸ‘¤ User"] --> UI
    UI --> Voice & Chat & Dashboard & Habits & Rewards & Profile & UserProvider & ChatProvider & DatabaseProvider & EventProvider
    ChatProvider --> ChatAPI
    UserProvider --> AuthAPI
    DatabaseProvider --> SessionAPI
    ChatAPI --> KeywordsAI & Mem0 & Tavily & CustomEvents & CSRF & RateLimit
    KeywordsAI --> OpenAI & KeywordsAPI & KeywordsAnalytics
    Tavily --> TavilyAPI
    Mem0 --> Supabase
    GeneralAgent --> DatabaseFunctions & MemoryFunctions & SearchFunctions & AnalyticsFunctions & KeywordsAI
    HabitCoach --> DatabaseFunctions & MemoryFunctions & SearchFunctions & KeywordsAI
    UserDataAgent --> DatabaseFunctions & KeywordsAI
    PointsCalc --> DatabaseFunctions & KeywordsAI
    RewardsManager --> DatabaseFunctions & KeywordsAI
    Greeter --> DatabaseFunctions & KeywordsAI
    DatabaseFunctions --> Supabase & IndexedDB & Performance
    MemoryFunctions --> VectorStore & Supabase
    Supabase --> SupabaseCloud & RLS
    VectorStore --> Mem0
    AuthAPI --> SupabaseAuth
    Supabase -. "Real-time Sync" .-> IndexedDB
    IndexedDB -. Offline First .-> Supabase
    Mem0 -. Memory Sync .-> VectorStore
    KeywordsAI -. Analytics .-> KeywordsAnalytics
    Voice --> ChatAPI
    Voice -. WebRTC .-> User
    Voice -. "Real-time Audio" .-> ChatAPI
    Dashboard -. Live Updates .-> DatabaseProvider
    Habits -. Instant Updates .-> DatabaseProvider

     User:::userClass
     UI:::frontendClass
     Voice:::frontendClass
     Chat:::frontendClass
     Dashboard:::frontendClass
     Habits:::frontendClass
     Rewards:::frontendClass
     Profile:::frontendClass
     KeywordsAI:::aiClass
     OpenAI:::aiClass
     Mem0:::aiClass
     Tavily:::aiClass
     GeneralAgent:::aiClass
     HabitCoach:::aiClass
     UserDataAgent:::aiClass
     PointsCalc:::aiClass
     RewardsManager:::aiClass
     Greeter:::aiClass
     Supabase:::storageClass
     IndexedDB:::storageClass
     VectorStore:::storageClass
     KeywordsAnalytics:::analyticsClass
     CustomEvents:::analyticsClass
     Performance:::analyticsClass
     SupabaseAuth:::securityClass
     RLS:::securityClass
     CSRF:::securityClass
     RateLimit:::securityClass
     SupabaseCloud:::storageClass
    classDef userClass fill:#e1f5fe,stroke:#01579b,stroke-width:3px
    classDef frontendClass fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef aiClass fill:#e8f5e8,stroke:#2e7d32,stroke-width:3px
    classDef storageClass fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef securityClass fill:#ffebee,stroke:#c62828,stroke-width:2px
    classDef analyticsClass fill:#e3f2fd,stroke:#1565c0,stroke-width:2px


